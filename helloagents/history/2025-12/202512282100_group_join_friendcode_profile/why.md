# 变更提案：群申请入群（审批）+ 个人主页 + FriendCode/GroupCode

## 背景与问题

当前交互存在以下体验/安全问题：
- **加群**：创建群时直接指定成员，不符合真实产品的“申请/邀请加入”流程，也缺少群管理（群主/踢人/管理员）。
- **加好友**：通过输入 `uid`（数值 id）添加，存在可枚举与骚扰风险；同时缺少“个人主页”作为承接入口。
- **用户/群展示缺失**：头像不可点击，缺少用户展示页；群聊缺少“群资料”入口。

## 目标与成功标准

### 目标
1. 群聊：支持“申请入群→群主/管理员审批→入群通知”，并具备群管理基础（群主/管理员/踢人/转让群主/设置管理员）。
2. 用户：新增个人主页（公开可见），点击头像进入；个人主页展示基础信息 + FriendCode + 一键申请好友。
3. 安全：加好友不再依赖暴露的 `uid` 输入，改为 FriendCode（不可枚举、可重置且限频）。
4. 群展示：提供群资料页/按钮（群聊界面入口），并支持通过 GroupCode 查找群并申请入群。

### 成功标准（可验证）
- 任意登录用户可访问他人“个人主页”并发起好友申请（通过 FriendCode）。
- 任意登录用户可通过 GroupCode 申请入群；群主/管理员可审批；申请者收到 WS 通知；入群后可进入群聊并收到群消息。
- 群主可：转让群主、设置/取消管理员、踢人；管理员可：审批入群、踢普通成员（不能踢群主/管理员）。
- 关键变更具备后备路径：即使 WS 推送失败，也可通过 HTTP 列表拉取（申请记录/成员列表）。

## 范围与非目标

范围内：
- FriendCode：生成、展示、重置（限频）、按码发起好友申请。
- GroupCode：生成、展示、重置（限频）、按码发起入群申请。
- 入群申请：申请/列表/审批/通知。
- 群管理：成员列表、踢人、设置管理员、转让群主、退出群。
- 前端：个人主页、群资料页、入口改造（头像可点、群资料按钮、加好友改 FriendCode、申请入群入口）。

范围外（本期不做）：
- 群邀请链接/二维码（本期走“申请入群”模型）
- 完整的隐私分级（陌生人/好友/群友）与黑名单系统
- 多实例“跨实例主动推送路由转发”（先保证落库与可拉取）

## 风险与规避

- 风险：WS 推送在多实例下无法保证落到正确实例。
  - 规避：所有关键通知均可通过 HTTP 拉取（管理员看申请列表、申请者看审批结果），WS 仅作体验增强。
- 风险：码的重置被滥用造成骚扰或难以追踪。
  - 规避：服务端强制限频；可配置冷却时间；必要时记录重置时间戳。

